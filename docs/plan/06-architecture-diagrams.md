# neuron-ui 架构图

> 本文档汇总 neuron-ui 项目的核心架构图，覆盖系统全景、包结构、数据流、组件开发、自动生成引擎、编辑器等维度。

---

## 图 1 / 系统全景架构

```
╔══════════════════════════════════════════════════════════════════════════════════════════════╗
║                                   neuron-ui 系统全景                                        ║
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                              ║
║   外部输入 (任意格式)            核心系统                              最终产出               ║
║  ┌──────────────┐          ┌────────────────────────────────────┐    ┌──────────────┐        ║
║  │ API 列表     │          │                                    │    │              │        ║
║  │ (Swagger/    │─────────►│      AI 驱动的页面生成引擎           │───►│  Page Schema │        ║
║  │  Postman/    │          │    @neuron-ui/generator             │    │  (JSON)      │        ║
║  │  文字描述)   │          │                                    │    └──────┬───────┘        ║
║  └──────────────┘          │  ┌────────┐  ┌────────────────┐   │           │                ║
║  ┌──────────────┐          │  │  AI    │  │ 参考映射规则    │   │           ▼                ║
║  │ TaskCase     │─────────►│  │ 理解   │─►│ 选组件+生Page   │   │    ┌──────────────┐        ║
║  │ (PRD/用户    │          │  │ 内容   │  │ Schema         │   │    │ 拖拉拽编辑器  │        ║
║  │  故事/描述)  │          │  └────────┘  └────────────────┘   │    │ @neuron-ui/   │        ║
║  └──────────────┘          └────────────────────────────────────┘    │ page-builder  │        ║
║                                         ▲                           │              │        ║
║                                         │                           │  ┌──┐ ┌──┐   │        ║
║                                         │                           │  │画│ │属│   │        ║
║                            ┌────────────┴─────────────┐             │  │布│ │性│   │        ║
║                            │    组件-接口映射规则       │             │  │  │ │面│   │        ║
║                            │  @neuron-ui/metadata     │             │  │  │ │板│   │        ║
║                            │                          │             │  └──┘ └──┘   │        ║
║                            │  component-manifest.json │             └──────┬───────┘        ║
║                            │  component-api-mapping   │                    │                ║
║                            │  composition-rules.json  │                    ▼                ║
║                            │  schemas/*.schema.json   │             ┌──────────────┐        ║
║                            └────────────▲─────────────┘             │  发布上线     │        ║
║                                         │                           │  (React App)  │        ║
║                            ┌────────────┴─────────────┐             └──────────────┘        ║
║                            │      neuron 组件库        │                    ▲                ║
║                            │  @neuron-ui/components   │                    │                ║
║                            │                          │                    │                ║
║                            │  53 个 N 前缀组件         │────────────────────┘                ║
║                            │  NButton NCard NDialog.. │     组件渲染                        ║
║                            └────────────▲─────────────┘                                     ║
║                                         │                                                    ║
║                            ┌────────────┴─────────────┐                                     ║
║                            │      Design Tokens        │                                     ║
║                            │   @neuron-ui/tokens       │                                     ║
║                            │                           │                                     ║
║                            │   tokens.json → CSS变量   │                                     ║
║                            │   14级暖灰 + 10辅助色     │                                     ║
║                            └───────────────────────────┘                                     ║
║                                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════════════════════╝
```

---

## 图 2 / 四层组件架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  Layer 3   自动生成 + 拖拉拽编辑                                              │
│  ═══════════════════════════════════════════════════════════════════════     │
│                                                                             │
│  ┌─────────────────────────────┐      ┌─────────────────────────────┐      │
│  │      @neuron-ui/generator   │      │   @neuron-ui/page-builder   │      │
│  │      (AI 调用编排层)         │      │                             │      │
│  │                             │      │  ┌───────────────────────┐  │      │
│  │  任意 API 列表 ──►          │      │  │ Canvas (拖拽画布)      │  │      │
│  │  任意 TaskCase ──► AI ──►  │─────►│  │ PropertyPanel (属性)  │  │      │
│  │  映射规则(参考) Page Schema │      │  │ ComponentPanel (组件)  │  │      │
│  │                             │      │  │ Renderer (json-render) │  │      │
│  └─────────────────────────────┘      │  └───────────────────────┘  │      │
│                                        └─────────────────────────────┘      │
│                                                    │                        │
│                                                    │ 消费                   │
│                                                    ▼                        │
│  Layer 2   neuron 组件 (N 前缀包装层)                                        │
│  ═══════════════════════════════════════════════════════════════════════     │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────┐      │
│  │  packages/components/src/neuron/                                 │      │
│  │                                                                  │      │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐  │      │
│  │  │ NButton │ │ NCard   │ │ NDialog │ │NDataTab │ │ NInput  │  │      │
│  │  │ capsule │ │ 5变体   │ │ 九宫定位│ │排序/过滤│ │ 无效态  │  │      │
│  │  │ circle  │ │ cover-* │ │         │ │ 分页    │ │ tag创建 │  │      │
│  │  │ 5级尺寸 │ │ profile │ │         │ │ 多变体  │ │         │  │      │
│  │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘  │      │
│  │       │           │           │           │           │        │      │
│  │  ┌────┴───────────┴───────────┴───────────┴───────────┴────┐   │      │
│  │  │  + 自定义变体  + 插槽系统  + data-neuron-* 属性          │   │      │
│  │  │  + 尺寸映射    + 颜色映射  + TypeScript Props 类型       │   │      │
│  │  └─────────────────────────────────────────────────────────┘   │      │
│  └──────────────────────────────────────────────────────────────────┘      │
│                                        │                                    │
│                                        │ 包装                               │
│                                        ▼                                    │
│  Layer 1   shadcn/ui 原语 (Radix UI + Tailwind)                             │
│  ═══════════════════════════════════════════════════════════════════════     │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────┐      │
│  │  packages/components/src/ui/                                     │      │
│  │                                                                  │      │
│  │  button.tsx │ card.tsx │ dialog.tsx │ input.tsx │ badge.tsx       │      │
│  │  sheet.tsx  │ checkbox.tsx │ radio-group.tsx │ switch.tsx         │      │
│  │  select.tsx │ combobox.tsx │ calendar.tsx │ data-table.tsx       │      │
│  │  ... (共对应 53 个 neuron 组件的 shadcn 原语)                    │      │
│  │                                                                  │      │
│  │  ┌───────────────────────────────────────────────────────────┐   │      │
│  │  │  Radix UI 底层: 无障碍 · ARIA · 键盘导航 · 焦点管理       │   │      │
│  │  │  CVA (class-variance-authority): 变体管理                  │   │      │
│  │  │  Tier B 微调: h-10→h-8, rounded-md→rounded-xl (记录在 SHADCN_OVERRIDES.md)│
│  │  └───────────────────────────────────────────────────────────┘   │      │
│  └──────────────────────────────────────────────────────────────────┘      │
│                                        │                                    │
│                                        │ 样式来自                            │
│                                        ▼                                    │
│  Layer 0   Design Tokens                                                    │
│  ═══════════════════════════════════════════════════════════════════════     │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────┐      │
│  │  @neuron-ui/tokens                                               │      │
│  │                                                                  │      │
│  │  tokens.json (单一来源)                                          │      │
│  │      │                                                           │      │
│  │      ├──► CSS 变量 (:root { --gray-01: #5F5D57; ... })           │      │
│  │      ├──► shadcn 语义映射 (--primary → var(--gray-01))           │      │
│  │      ├──► @theme inline (注册为 Tailwind 工具类)                  │      │
│  │      └──► TypeScript 常量 (export const colors = {...} as const) │      │
│  │                                                                  │      │
│  │  14级暖灰 · 10辅助色 · 3语义色 · 10间距 · 5圆角 · 7字号          │      │
│  └──────────────────────────────────────────────────────────────────┘      │
│                                                                             │
│  侧面支撑   @neuron-ui/metadata                                            │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─       │
│  ┌──────────────────────────────────────────────────────────────────┐      │
│  │  component-manifest.json (AI 入口: 组件清单)                      │      │
│  │  component-api-mapping.json (字段→组件 + API模式→页面)            │      │
│  │  composition-rules.json (组件嵌套约束)                            │      │
│  │  schemas/*.schema.json (每个组件的 Props 定义)                    │      │
│  │  builder-registry/ (搭建平台注册数据)                             │      │
│  └──────────────────────────────────────────────────────────────────┘      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 图 3 / 包依赖关系

```
                    ┌──────────────────────────┐
                    │   @neuron-ui/page-builder │
                    │   (Web App - 拖拉拽编辑器) │
                    └─────┬──────┬──────┬──────┘
                          │      │      │
              ┌───────────┘      │      └───────────┐
              ▼                  ▼                   ▼
┌─────────────────────┐  ┌──────────────┐  ┌────────────────────┐
│ @neuron-ui/generator │  │ @neuron-ui/  │  │ @neuron-ui/        │
│ (自动生成引擎)       │  │ metadata     │  │ components         │
│                      │  │ (映射规则)   │  │ (53个组件)          │
└──────────┬──────────┘  └──────┬───────┘  └──────────┬─────────┘
           │                    │                      │
           └──────────┬─────────┘                      │
                      │                                │
                      ▼                                ▼
              ┌──────────────┐                ┌──────────────────┐
              │ @neuron-ui/  │                │ @neuron-ui/      │
              │ components   │                │ tokens           │
              │ (类型依赖)   │                │ (CSS + TS)       │
              └──────┬───────┘                └──────────────────┘
                     │                                 ▲
                     └─────────────────────────────────┘

构建顺序: tokens → components → metadata → generator → page-builder
                                                         (并行)
发布策略:
  tokens       → npm publish (CSS + TS 常量)
  components   → npm publish (React 组件)
  metadata     → npm publish (JSON Schema)
  generator    → npm publish (生成引擎)
  page-builder → 部署为 Web App (不发 npm)
```

---

## 图 4 / 端到端数据流

```
输入 (任意格式)                     AI 处理                             调整                 产出
════════════                       ═══════                             ════                 ════

┌───────────────┐
│ API 列表       │
│ (任意格式)     │
│               │
│ · Swagger     │          ┌──────────────────────────────┐    ┌──────────────┐    ┌──────────┐
│ · Postman     │─────────►│                              │    │              │    │          │
│ · 文字描述    │          │            AI                │    │              │    │          │
│ · cURL 集合   │          │                              │───►│  Page        │───►│  Editor  │───► 发布
└───────────────┘          │  1. 理解 API 内容             │    │  Schema      │    │          │
                           │     识别资源/接口/字段/类型   │    │  (JSON)      │    │  拖拽    │
┌───────────────┐          │                              │    │              │    │  属性    │
│ TaskCase      │          │  2. 理解 TaskCase 意图        │    │  tree: [     │    │  替换    │
│ (任意格式)     │─────────►│     识别页面/操作/流程        │    │   NDataTable │    │  绑定    │
│               │          │                              │    │   NDialog    │    │          │
│ · PRD 文档    │          │  3. 参考映射规则选择组件       │    │   NSheet     │    │          │
│ · 用户故事    │          │     字段→组件 / 模式→模板     │    │   ...        │    └──────────┘
│ · 文字描述    │          │                              │    │  ]           │
│ · 一句话需求  │          │  4. 输出 Page Schema          │    └──────────────┘
└───────────────┘          │     组件树 + 数据绑定         │
                           └──────────────┬───────────────┘
                                          │ 参考
                                          ▼
                            ┌────────────────────────────┐
                            │  component-api-mapping.json │
                            │  (AI 的参考指南)             │
                            │                            │
                            │  fieldTypeMapping:         │
                            │    string → NInput/NText   │
                            │    boolean → NSwitch       │
                            │    date → NDatePicker      │
                            │    enum → NCombobox/NBadge │
                            │                            │
                            │  apiPatternMapping:        │
                            │    GET /list → list-page   │
                            │    POST /   → create-form  │
                            │    PUT /:id → edit-form    │
                            │    DELETE   → delete-confirm│
                            │                            │
                            │  compositePatterns:        │
                            │    CRUD / Dashboard /      │
                            │    Detail-with-tabs        │
                            └────────────────────────────┘
```

---

## 图 5 / Token 系统流转

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         tokens.json (单一来源)                          │
│                                                                         │
│  {                                                                      │
│    "colors": { "gray": { "01": "#5F5D57", ... "14": "#FCFCFC" },       │
│                "accent": { "pink": "#FFC4E1", "blue": "#BEF1FF", ...}  │
│                "semantic": { "error": "#E67853", ... } },              │
│    "spacing": { "xs": "4px", "sm": "8px", ... "4xl": "64px" },        │
│    "radius":  { "sm": "4px", ... "full": "9999px" },                   │
│    "typography": { "fontFamily": {...}, "fontSize": {...} }             │
│  }                                                                      │
└──────────┬──────────────────────┬──────────────────────┬────────────────┘
           │                      │                      │
  generate-tokens.ts     generate-tokens.ts     generate-tokens.ts
           │                      │                      │
           ▼                      ▼                      ▼
┌─────────────────┐    ┌──────────────────┐    ┌──────────────────────┐
│ CSS 变量         │    │ Tailwind 注册     │    │ TypeScript 常量       │
│                  │    │                   │    │                      │
│ :root {          │    │ @theme inline {   │    │ export const colors  │
│  --gray-01:      │    │  --color-gray-01: │    │   = { gray01:        │
│    #5F5D57;      │    │    var(--gray-01);│    │     "#5F5D57",       │
│  --gray-14:      │    │  --color-accent-  │    │     ...              │
│    #FCFCFC;      │    │    pink: var(...);│    │   } as const;        │
│  --accent-pink:  │    │  --radius-xl:     │    │                      │
│    #FFC4E1;      │    │    var(--radius-  │    │ export const spacing │
│  ...             │    │    xl);           │    │   = { xs: "4px",     │
│ }                │    │  --font-heading:  │    │     ... } as const;  │
│                  │    │    var(--font-    │    │                      │
│ /* shadcn 映射 */│    │    heading);      │    │                      │
│ --primary:       │    │ }                 │    │                      │
│   var(--gray-01);│    │                   │    │                      │
│ --border:        │    │                   │    │                      │
│   var(--gray-09);│    │                   │    │                      │
│ ...              │    │                   │    │                      │
└────────┬─────────┘    └─────────┬─────────┘    └──────────┬───────────┘
         │                        │                          │
         ▼                        ▼                          ▼
┌────────────────────────────────────────────────────────────────────────┐
│                          开发者使用方式                                 │
│                                                                        │
│  CSS:      color: var(--gray-01);   border: 1px solid var(--gray-09); │
│  Tailwind: bg-gray-12  text-gray-01  rounded-xl  bg-accent-pink      │
│  shadcn:   bg-primary  text-muted-foreground  border (自动暖灰)       │
│  TS:       import { colors } from "@neuron-ui/tokens"                 │
│            colors.gray01  // "#5F5D57"                                │
└────────────────────────────────────────────────────────────────────────┘
```

---

## 图 6 / shadcn 三层定制模型

```
╔════════════════════════════════════════════════════════════════════════╗
║                     shadcn 三层定制策略                                ║
╠════════════════════════════════════════════════════════════════════════╣
║                                                                        ║
║  ┌──────────────────────────────────────────────────────────────────┐  ║
║  │ Tier A: CSS 变量重映射                              覆盖率 ~80%  │  ║
║  │ ────────────────────────────────────────────────────────────     │  ║
║  │ 方式: 在 globals.css 中重定义 shadcn 语义变量                    │  ║
║  │ 效果: 所有 shadcn 组件自动获得暖灰色系                           │  ║
║  │ 修改量: 0 行组件代码                                             │  ║
║  │                                                                  │  ║
║  │   --primary ──────► var(--gray-01)  ──► #5F5D57 (主文字)         │  ║
║  │   --border ───────► var(--gray-09)  ──► #DCDAD4 (边框)           │  ║
║  │   --background ──► var(--gray-13)  ──► #F9F8F6 (页面背景)        │  ║
║  │   --muted ────────► var(--gray-12)  ──► #F3F1ED (柔和背景)       │  ║
║  │   --destructive ──► var(--color-error) ──► #E67853 (危险)        │  ║
║  └──────────────────────────────────────────────────────────────────┘  ║
║                                    │                                    ║
║                                    ▼                                    ║
║  ┌──────────────────────────────────────────────────────────────────┐  ║
║  │ Tier B: shadcn 原语 class 微调                      覆盖率 ~15%  │  ║
║  │ ────────────────────────────────────────────────────────────     │  ║
║  │ 方式: 直接修改 ui/*.tsx 中的 Tailwind class                      │  ║
║  │ 记录: 每项修改写入 SHADCN_OVERRIDES.md (便于升级恢复)            │  ║
║  │                                                                  │  ║
║  │   button.tsx:   h-10 ──► h-8          (高度 40px → 32px)         │  ║
║  │   button.tsx:   rounded-md ──► rounded-xl  (圆角 6px → 20px)    │  ║
║  │   badge.tsx:    h-5 ──► h-4           (高度 20px → 16px)         │  ║
║  │   input.tsx:    h-10 ──► h-8          (高度 40px → 32px)         │  ║
║  │   card.tsx:     rounded-lg ──► rounded-xl  (圆角 8px → 12px)    │  ║
║  └──────────────────────────────────────────────────────────────────┘  ║
║                                    │                                    ║
║                                    ▼                                    ║
║  ┌──────────────────────────────────────────────────────────────────┐  ║
║  │ Tier C: neuron 包装层                               覆盖率 ~5%   │  ║
║  │ ────────────────────────────────────────────────────────────     │  ║
║  │ 方式: neuron/NXxx/ 包装 ui/xxx, 添加业务逻辑                     │  ║
║  │ 影响: shadcn 升级完全不影响此层                                   │  ║
║  │                                                                  │  ║
║  │   NButton 包装 ui/button                                         │  ║
║  │   ├── + capsule/circle/custom 三种变体                           │  ║
║  │   ├── + xs/sm/md/lg/xl 五级尺寸                                  │  ║
║  │   ├── + 7 种 accent 颜色 prop                                    │  ║
║  │   ├── + icon slot (left/right)                                   │  ║
║  │   └── + data-neuron-component="NButton"                          │  ║
║  │                                                                  │  ║
║  │   NCard 包装 ui/card                                             │  ║
║  │   ├── + 5 种变体 (cover-left/top/full/profile/notification)      │  ║
║  │   ├── + media/body/badges/actions 插槽                           │  ║
║  │   └── + data-neuron-component="NCard"                            │  ║
║  └──────────────────────────────────────────────────────────────────┘  ║
║                                                                        ║
║  升级流程:                                                              ║
║  npx shadcn@latest diff → 替换 ui/*.tsx → 恢复 Tier B → neuron 不动    ║
║                                                                        ║
╚════════════════════════════════════════════════════════════════════════╝
```

---

## 图 7 / AI 驱动的页面生成管线

```
                         ┌─────────────────────────────────────────┐
                         │    @neuron-ui/generator (AI 编排层)      │
                         └─────────────────────────────────────────┘

 ╔═══════════════╗      ╔═══════════════╗      ╔═══════════════╗      ╔═══════════════╗
 ║  STEP 1       ║      ║  STEP 2       ║      ║  STEP 3       ║      ║  STEP 4       ║
 ║  加载上下文    ║─────►║  构建 Prompt   ║─────►║  调用 AI API   ║─────►║  校验输出     ║
 ╚═══════════════╝      ╚═══════════════╝      ╚═══════════════╝      ╚═══════════════╝

      │                       │                       │                       │
      ▼                       ▼                       ▼                       ▼

 ┌───────────────┐     ┌───────────────┐     ┌───────────────┐     ┌───────────────┐
 │ 加载 AI 参考   │     │ 构建完整      │     │               │     │ 校验 AI 输出   │
 │ 资料:          │     │ Prompt:       │     │   AI 生成      │     │               │
 │               │     │               │     │               │     │ ✓ JSON 格式    │
 │ component-api │     │ System:       │     │ AI 阅读并理解  │     │ ✓ Schema 结构  │
 │  -mapping     │     │  映射规则     │     │ 用户的 API 列表│     │ ✓ 嵌套合规     │
 │  .json        │     │  组件清单     │     │ 和 TaskCase    │     │ ✓ 绑定完整     │
 │               │     │  嵌套约束     │     │               │     │ ✓ Token 合规   │
 │ component-    │     │  格式要求     │     │ AI 参考映射规则│     │               │
 │  manifest     │     │  Token 约束   │     │ 选择组件、     │     │ 失败?          │
 │  .json        │     │               │     │ 生成页面模板   │     │ ├─ 自动修复    │
 │               │     │ Few-shot:     │     │               │     │ └─ 重试(≤2次)  │
 │ composition-  │     │  CRUD 示例    │     │ 输出:          │     │               │
 │  rules.json   │     │  Dashboard 示例│     │ Page Schema   │     │ 成功 →        │
 │               │     │  Detail 示例   │     │ JSON          │     │ 返回给编辑器   │
 │ Design Tokens │     │               │     │               │     │               │
 │               │     │ User:         │     │               │     │               │
 │               │     │  API 列表     │     │               │     │               │
 │               │     │  (任意格式)   │     │               │     │               │
 │               │     │  TaskCase     │     │               │     │               │
 │               │     │  (任意格式)   │     │               │     │               │
 └───────────────┘     └───────────────┘     └───────────────┘     └───────────────┘


复合模式自动检测:
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  同一资源有 GET + POST + PUT + DELETE?                               │
│  ──► CRUD 模式                                                      │
│      ┌─────────────────────────────────────────────────────────┐    │
│      │  toolbar:  NButton(新建) + NInputGroup(搜索)            │    │
│      │  main:     NDataTable(列表) + NPagination               │    │
│      │  create:   NDialog + NField[] (POST 字段)               │    │
│      │  edit:     NSheet + NField[] (PUT 字段, 预填值)          │    │
│      │  delete:   NAlertDialog (确认弹窗)                      │    │
│      │  actions:  NDropdownMenu (行操作: 编辑/删除)             │    │
│      │  feedback: NToast (操作结果)                             │    │
│      │  empty:    NEmpty (无数据)                               │    │
│      │  loading:  NSkeleton (加载中)                            │    │
│      └─────────────────────────────────────────────────────────┘    │
│                                                                     │
│  多个 GET 统计接口?                                                  │
│  ──► Dashboard 模式                                                 │
│      NCard[] + NChart[] + NProgress + NDataTable                    │
│                                                                     │
│  GET 详情有多维度数据?                                               │
│  ──► Detail-with-tabs 模式                                          │
│      NCard(头部) + NTabs(分区) + NDataTable/NAccordion(内容)        │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 图 8 / 拖拉拽编辑器架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        @neuron-ui/page-builder                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─── Toolbar ──────────────────────────────────────────────────────────┐   │
│  │  [↩ 撤销] [↪ 重做] [👁 预览] [📱 响应式] [💾 保存] [📤 导出/发布]   │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌───────────────┐  ┌───────────────────────────────┐  ┌────────────────┐  │
│  │ ComponentPanel│  │         Canvas (画布)          │  │ PropertyPanel  │  │
│  │ (左侧组件面板) │  │                               │  │ (右侧属性面板) │  │
│  │               │  │  ┌─────────────────────────┐   │  │                │  │
│  │ ┌───────────┐ │  │  │  EditorRenderer          │   │  │ 选中: NButton │  │
│  │ │ 展示组件  │ │  │  │  (json-render Renderer)  │   │  │                │  │
│  │ │ NDataTable│ │  │  │                          │   │  │ variant:      │  │
│  │ │ NCard     │ │  │  │  ┌──────────────────┐   │   │  │ [capsule ▼]   │  │
│  │ │ NChart    │ │  │  │  │ NDataTable       │   │   │  │               │  │
│  │ │ NAvatar   │ │  │  │  │ ┌──┬──┬──┬──┐    │   │   │  │ size:         │  │
│  │ │ NBadge    │ │  │  │  │ │  │  │  │  │    │   │   │  │ [md ▼]        │  │
│  │ │ ...       │ │  │  │  │ │  │  │  │  │    │   │   │  │               │  │
│  │ ├───────────┤ │  │  │  │ └──┴──┴──┴──┘    │   │   │  │ color:        │  │
│  │ │ 输入组件  │ │  │  │  └──────────────────┘   │   │  │ [blue ▼]      │  │
│  │ │ NInput    │ │  │  │                          │   │  │               │  │
│  │ │ NTextarea │ │  │  │  ┌─[+新建]──────────┐   │   │  │ label:        │  │
│  │ │ NCombobox │ │  │  │  │ NDialog          │   │   │  │ [提交____]    │  │
│  │ │ NSwitch   │ │  │  │  │ ┌──────────────┐ │   │   │  │               │  │
│  │ │ ...       │ │  │  │  │ │ NField       │ │   │   │  │ ──────────    │  │
│  │ ├───────────┤ │  │  │  │ │ NField       │ │   │   │  │ 数据绑定:    │  │
│  │ │ 容器组件  │ │  │  │  │ │ NField       │ │   │   │  │ onClick:      │  │
│  │ │ NDialog   │ │  │  │  │ └──────────────┘ │   │   │  │ [POST /users] │  │
│  │ │ NSheet    │ │  │  │  │  [取消] [确认]   │   │   │  │               │  │
│  │ │ NDrawer   │ │  │  │  └──────────────────┘   │   │  │ ──────────    │  │
│  │ │ ...       │ │  │  │                          │   │  │ 组件替换:    │  │
│  │ ├───────────┤ │  │  │                          │   │  │ [🔄 替换组件] │  │
│  │ │ 布局组件  │ │  │  └──────────────────────────┘   │  │ [➕ 添加子组件]│  │
│  │ │ NTabs     │ │  │                                 │  │                │  │
│  │ │ NSidebar  │ │  │  ┌── Breadcrumb ────────────┐   │  │                │  │
│  │ │ ...       │ │  │  │ Page > NDataTable > 列3  │   │  │                │  │
│  │ └───────────┘ │  │  └──────────────────────────┘   │  │                │  │
│  └───────────────┘  └─────────────────────────────────┘  └────────────────┘  │
│                                                                             │
├─── 状态管理 ────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  Zustand + zundo (temporal) 中间件                                    │   │
│  │                                                                      │   │
│  │  editor-store.ts:                                                    │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐               │   │
│  │  │ pageSchema   │  │ undoStack    │  │ redoStack    │               │   │
│  │  │ (当前页面树) │  │ (历史记录)   │  │ (重做记录)   │               │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘               │   │
│  │                                                                      │   │
│  │  selection-store.ts:                                                 │   │
│  │  ┌──────────────┐  ┌──────────────┐                                 │   │
│  │  │ selectedId   │  │ hoveredId    │                                 │   │
│  │  │ (选中节点)   │  │ (悬停节点)   │                                 │   │
│  │  └──────────────┘  └──────────────┘                                 │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
├─── 渲染管线 ────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Page Schema (JSON)                                                         │
│       │                                                                     │
│       ▼                                                                     │
│  json-render ──── Catalog ──────────── Zod props 校验 (53 组件)            │
│       │           Registry ──────────── "NButton" → <NButton ... />        │
│       │           SchemaAdapter ──────── Page Schema → UITree 扁平化       │
│       ▼                                                                     │
│  React 组件树 → DOM → 画布渲染                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 图 9 / 组件-接口映射与决策树

```
┌─────────────────────────────────────────────────────────────────────────┐
│                  53 个组件的 API 角色分布                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│         GET (读取)              POST/PUT (写入)         DELETE (删除)    │
│         ═════════              ══════════════          ═══════════       │
│                                                                         │
│  ┌─────────────────┐    ┌─────────────────────┐    ┌───────────────┐   │
│  │ 数据展示 (15)    │    │ 数据输入 (13)        │    │ 确认操作       │   │
│  │                  │    │                      │    │               │   │
│  │ NDataTable       │    │ NInput    NField     │    │ NAlertDialog  │   │
│  │ NCard            │    │ NTextarea NLabel     │    │ NDialog       │   │
│  │ NChart           │    │ NCombobox NSelect    │    │ NButton       │   │
│  │ NCalendar        │    │ NCheckbox            │    │ NToast        │   │
│  │ NCarousel        │    │ NRadioGroup          │    │               │   │
│  │ NScrollArea      │    │ NSwitch              │    └───────────────┘   │
│  │ NAvatar          │    │ NDatePicker          │                        │
│  │ NBadge           │    │ NSlider              │    ┌───────────────┐   │
│  │ NText            │    │ NInputOTP            │    │ 操作触发 (3)   │   │
│  │ NAccordion       │    │                      │    │               │   │
│  │ NHoverCard       │    └─────────────────────┘    │ NButton       │   │
│  │ NProgress        │                                │ NDropdownMenu │   │
│  │ NSkeleton        │    ┌─────────────────────┐    │ NContextMenu  │   │
│  │ NEmpty           │    │ 容器 (7)             │    └───────────────┘   │
│  │ NPagination      │    │                      │                        │
│  │                  │    │ NDialog (创建/编辑)  │    ┌───────────────┐   │
│  └─────────────────┘    │ NAlertDialog (确认)  │    │ 反馈 (3)      │   │
│                          │ NSheet (编辑面板)    │    │               │   │
│  ┌─────────────────┐    │ NDrawer (移动端)     │    │ NToast        │   │
│  │ 导航 (5)        │    │ NTabs  NCollapsible  │    │ NAlert        │   │
│  │                  │    │ NPopover             │    │ NSpinner      │   │
│  │ NBreadcrumb     │    └─────────────────────┘    └───────────────┘   │
│  │ NSidebar        │                                                     │
│  │ NMenubar        │    ┌─────────────────────┐                         │
│  │ NNavigationMenu │    │ 布局/辅助 (7)       │                         │
│  │ NCommand        │    │ 无直接 API 关联      │                         │
│  └─────────────────┘    │                      │                         │
│                          │ NSeparator NTooltip │                         │
│                          │ NAspectRatio NKbd   │                         │
│                          │ NResizable          │                         │
│                          │ NToggle NToggleGroup│                         │
│                          └─────────────────────┘                         │
│                                                                         │
├─── 字段类型 → 组件决策树 ───────────────────────────────────────────────┤
│                                                                         │
│  API 字段                                                               │
│    │                                                                    │
│    ├── 出现在 Response (GET)?                                           │
│    │     ├── array<object> ──────────► NDataTable / NAccordion          │
│    │     ├── string:enum ────────────► NBadge                           │
│    │     ├── string:image ───────────► NAvatar / NCard media            │
│    │     ├── number:percentage ──────► NProgress                        │
│    │     ├── array<number> ──────────► NChart                           │
│    │     ├── object:user ────────────► NAvatar + NText                  │
│    │     ├── 空数据 ─────────────────► NEmpty                           │
│    │     └── 其他 ───────────────────► NText                            │
│    │                                                                    │
│    └── 出现在 Request (POST/PUT)?                                       │
│          ├── string:enum (≤5 选项) ──► NSelect / NRadioGroup            │
│          ├── string:enum (>5 选项) ──► NCombobox                        │
│          ├── string:long ────────────► NTextarea                        │
│          ├── boolean ────────────────► NSwitch                          │
│          ├── date/datetime ──────────► NDatePicker                      │
│          ├── number:range ───────────► NSlider                          │
│          ├── otp ────────────────────► NInputOTP                        │
│          ├── 其他 string/number ─────► NInput                           │
│          └── 每个字段用 NField 包装 (NLabel + 输入组件 + 错误提示)       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 图 10 / 组件替换机制 (编辑器)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    编辑器中的组件替换操作                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Type A: 整体替换                                                       │
│  ═══════════════                                                        │
│                                                                         │
│  ┌──────────────────┐              ┌──────────────────┐                │
│  │ NDataTable       │    🔄        │ NCard Grid       │                │
│  │ ┌──┬──┬──┬──┐    │  ─────►     │ ┌────┐ ┌────┐    │                │
│  │ │  │  │  │  │    │  替换        │ │Card│ │Card│    │                │
│  │ │  │  │  │  │    │              │ └────┘ └────┘    │                │
│  │ │  │  │  │  │    │              │ ┌────┐ ┌────┐    │                │
│  │ └──┴──┴──┴──┘    │              │ │Card│ │Card│    │                │
│  └──────────────────┘              │ └────┘ └────┘    │                │
│  同 GET 角色的展示组件可互换        └──────────────────┘                │
│                                                                         │
│  Type B: 子组件替换                                                     │
│  ═════════════════                                                      │
│                                                                         │
│  NDataTable 的某一列:                                                   │
│  ┌──────────┐              ┌──────────┐                                │
│  │  NBadge  │    🔄        │  NSwitch │                                │
│  │ "进行中" │  ─────►     │  [═══●]  │                                │
│  │          │  替换列组件   │          │                                │
│  └──────────┘              └──────────┘                                │
│  替换后自动映射: status 字段 → NSwitch checked prop                     │
│                                                                         │
│  Type C: 子组件组合                                                     │
│  ═════════════════                                                      │
│                                                                         │
│  NDataTable 的某一列:                                                   │
│  ┌──────────┐              ┌──────────────────┐                        │
│  │  NText   │    ➕        │ NAvatar + NText  │                        │
│  │ "张三"   │  ─────►     │ [👤] 张三        │                        │
│  │          │  添加子组件   │                  │                        │
│  └──────────┘              └──────────────────┘                        │
│  字段自动映射: avatar_url → NAvatar.src, name → NText.content           │
│                                                                         │
├─── 替换建议算法 ────────────────────────────────────────────────────────┤
│                                                                         │
│  用户点击 [🔄 替换]                                                     │
│       │                                                                 │
│       ▼                                                                 │
│  查询 component-api-mapping.json                                       │
│       │                                                                 │
│       ├── 当前组件 API 角色? (GET consumer / POST producer / ...)       │
│       │                                                                 │
│       ├── 当前字段类型? (string:enum / boolean / date / ...)            │
│       │                                                                 │
│       ▼                                                                 │
│  返回同角色可替换组件列表                                                │
│  ┌─────────────────────────────────────────────────┐                   │
│  │ NBadge (当前)                                    │                   │
│  │ ─────────────────────────────────                │                   │
│  │ 可替换为:                                        │                   │
│  │   NSwitch    (布尔展示/切换)                     │                   │
│  │   NText      (纯文本展示)                        │                   │
│  │   NProgress  (进度展示, 若字段为 number)          │                   │
│  └─────────────────────────────────────────────────┘                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 图 11 / Page Schema 生命周期

```
┌────────────────────────────────────────────────────────────────────────────────────────┐
│                              Page Schema 生命周期                                      │
├────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                        │
│   生成                    编辑                     渲染                    发布          │
│                                                                                        │
│  ┌──────────┐         ┌──────────┐           ┌──────────┐          ┌──────────┐       │
│  │ Generator│────────►│ Editor   │──────────►│ Renderer │─────────►│ Runtime  │       │
│  │ 自动生成 │  v1.0   │ 人工调整 │   v1.1    │ 预览渲染 │  v1.1   │ 生产运行 │       │
│  └──────────┘         └──────────┘           └──────────┘          └──────────┘       │
│       │                    │                      │                     │               │
│       ▼                    ▼                      ▼                     ▼               │
│                                                                                        │
│  Page Schema v1.0     Page Schema v1.1       React 组件树          React App            │
│  ┌────────────────┐   ┌────────────────┐    ┌─────────────┐     ┌─────────────┐       │
│  │{               │   │{               │    │<NDataTable>  │     │ 带数据绑定  │       │
│  │ tree: [        │   │ tree: [        │    │  <Column>    │     │ 的完整页面  │       │
│  │  {NDataTable,  │   │  {NCard grid,  │    │    <NBadge/> │     │             │       │
│  │   columns: [   │   │   items: [     │    │    <NAvatar/>│     │ API 调用    │       │
│  │    NBadge,     │   │    NAvatar+    │    │  </Column>   │     │ 事件处理    │       │
│  │    NText       │   │    NText,      │    │</NDataTable> │     │ 状态管理    │       │
│  │   ]},          │   │    NBadge      │    │<NDialog>     │     │             │       │
│  │  {NDialog...}  │   │   ]},          │    │  <NField/>   │     └─────────────┘       │
│  │ ],             │   │  {NDialog,     │    │  <NField/>   │                            │
│  │ dataSources:[  │   │   fields:      │    │</NDialog>    │                            │
│  │  {GET /users}  │   │   [NInput,     │    └─────────────┘                            │
│  │ ]              │   │    NCombobox,  │                                                │
│  │}               │   │    NSwitch]}  │                                                │
│  └────────────────┘   │ ]             │                                                │
│                        │}              │                                                │
│  自动生成               └────────────────┘                                                │
│  100% 映射规则                                                                          │
│                        手动调整                                                          │
│                        替换 NDataTable → NCard grid                                     │
│                        列内 NText → NAvatar + NText                                     │
│                        添加字段, 修改属性                                                 │
│                                                                                        │
└────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 图 12 / 目标依赖与执行时间线

```
                    阶段 1               阶段 2            阶段 3            阶段 4
                    基建                 映射              自动生成          编辑器
                    ─────               ────              ────────          ──────

目标 1              ██████████████
shadcn 二次开发     │ tokens.json  │
53 个组件           │ CSS 变量      │
                    │ 53 组件开发   │
                    │ Storybook    │
                    │ 单元测试      │
                                  │
目标 2                            ████████████
组件-接口映射                      │ API角色标注  │
                                  │ 字段→组件    │
                                  │ 决策树       │
                                  │ mapping.json│
                                               │
目标 3                                         ████████████████
AI 驱动生成                                     │ Prompt 设计   │
                                               │ Few-shot 示例 │
                                               │ AI 调用编排   │
                                               │ Page Schema  │
                                               │ 输出校验      │
                                                             │
目标 4                                                       ████████████████
拖拉拽编辑器                                                  │ Canvas       │
                                                             │ PropertyPanel│
                                                             │ 组件替换      │
                                                             │ Undo/Redo   │
                                                             │ 预览/发布    │

依赖链:
目标 1 ──► 目标 2 ──► 目标 3 ──► 目标 4
(地基)    (桥梁)    (引擎)    (最后一公里)

packages/tokens → packages/components → packages/metadata → packages/generator → packages/page-builder
```

---

## 图 13 / 技术栈总览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          neuron-ui 技术栈                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  框架层                                                                 │
│  ┌──────────┐  ┌────────────┐  ┌──────────────┐  ┌──────────────────┐  │
│  │ React 18+│  │ TypeScript │  │ Tailwind v4  │  │ Radix UI        │  │
│  │          │  │ 5.x        │  │ CSS-first    │  │ 无障碍/ARIA     │  │
│  └──────────┘  └────────────┘  └──────────────┘  └──────────────────┘  │
│                                                                         │
│  UI 基础                                                                │
│  ┌───────────────────────┐  ┌──────────────────┐  ┌──────────────────┐ │
│  │ shadcn/ui             │  │ CVA              │  │ clsx +           │ │
│  │ 组件代码复制到项目     │  │ class-variance-  │  │ tailwind-merge  │ │
│  │ 完全可控              │  │ authority        │  │ = cn()          │ │
│  └───────────────────────┘  └──────────────────┘  └──────────────────┘ │
│                                                                         │
│  构建 & 工程化                                                          │
│  ┌──────────┐  ┌────────────┐  ┌──────────────┐  ┌──────────────────┐ │
│  │ Vite     │  │ pnpm       │  │ turborepo    │  │ ESLint +         │ │
│  │ 构建/开发│  │ workspace  │  │ 构建编排     │  │ Prettier         │ │
│  └──────────┘  └────────────┘  └──────────────┘  └──────────────────┘ │
│                                                                         │
│  状态 & 交互                                                            │
│  ┌──────────────────┐  ┌──────────────┐  ┌──────────────────────────┐ │
│  │ Zustand          │  │ dnd-kit      │  │ zundo (temporal)         │ │
│  │ 轻量状态管理     │  │ 拖拽交互     │  │ undo/redo 中间件        │ │
│  └──────────────────┘  └──────────────┘  └──────────────────────────┘ │
│                                                                         │
│  测试 & 文档                                                            │
│  ┌──────────┐  ┌────────────────┐  ┌──────────────────────────────┐   │
│  │ Vitest   │  │ Testing Library│  │ Storybook                    │   │
│  │ 单元测试 │  │ 组件测试       │  │ 组件文档/可视化浏览          │   │
│  └──────────┘  └────────────────┘  └──────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```
