# Phase 6: 集成测试 + 端到端验证

> 全链路打通：API 输入 → AI 生成 → 编辑器渲染 → 可视化调整 → 导出。

---

## 依赖

- 全部 Phase 0-5 完成

## 端到端测试场景

### 场景 1: CRUD 列表页 (主场景)

**输入:**
- API: 赛事管理 CRUD 接口 (GET/POST/PUT/DELETE)
- TaskCase: "帮我生成一个赛事管理的 CRUD 页面"

**验证:**

| 步骤 | 预期结果 |
|------|---------|
| AI 生成 | Page Schema 含 NDataTable + NDialog(创建) + NSheet(编辑) + NAlertDialog(删除) |
| 校验通过 | 格式合法, 嵌套合规, 绑定完整, Token 合规 |
| 编辑器加载 | 页面在画布中正确渲染 |
| 调整文案 | 修改按钮文字, 实时预览 |
| 调整颜色 | Token 下拉选择, 生效 |
| 拖拽排序 | 表格列顺序改变 |
| 组件替换 | NDataTable → NCard 网格, 数据绑定保留 |
| 撤销/重做 | 操作可撤销 |
| 导出 JSON | 输出合法 Page Schema |

### 场景 2: Dashboard 仪表盘

**输入:**
- API: 多个 GET 统计接口
- TaskCase: "生成一个数据统计仪表盘"

**验证:**

| 步骤 | 预期结果 |
|------|---------|
| AI 生成 | NCard[] + NChart[] + NProgress |
| 编辑器加载 | 卡片和图表正确渲染 |
| 调整布局 | 拖拽调整卡片位置 |

### 场景 3: 任意格式输入

**验证 AI 对不同格式的处理:**

| 输入格式 | API | TaskCase |
|---------|-----|---------|
| Swagger JSON | OpenAPI spec | 结构化 JSON |
| Postman Collection | Postman 导出 | PRD 文档 |
| 文字描述 | "有一组赛事管理接口..." | "帮我生成 CRUD 页面" |
| cURL 集合 | cURL 命令列表 | 一句话描述 |
| 表格 | Markdown/CSV 表格 | 流程图描述 |

生成质量应当一致。

### 场景 4: 错误处理

| 输入 | 预期行为 |
|------|---------|
| 空 API 列表 | 友好错误提示 |
| 不含 API 的文本 | AI 尽力理解或报告无法识别 |
| 生成结果校验失败 | 自动修复 + 重试 |
| 组件嵌套违规 | 校验器报告具体位置和修复建议 |

## 性能验证

| 指标 | 目标 |
|------|------|
| AI 生成时间 | ≤ 30 秒 (含重试) |
| Page Schema 加载到编辑器 | ≤ 1 秒 |
| 拖拽操作延迟 | ≤ 16ms (60fps) |
| 撤销/重做响应 | ≤ 50ms |
| 组件懒加载 | 按需, 首屏 ≤ 3 秒 |

## 回归测试

每次修改后需验证:

- [ ] Token 生成脚本正常运行
- [ ] 所有组件 Storybook 渲染正确
- [ ] 组件单测全部通过 (覆盖率 ≥ 80%)
- [ ] Page Schema 校验器正确工作
- [ ] AI 生成 → 校验 → 编辑器加载 全链路通过
- [ ] 撤销/重做正确
- [ ] 组件替换保留数据绑定

## 最终验收标准

| # | 标准 |
|---|------|
| 1 | 从任意格式 API + TaskCase 到可视化页面, 全链路 5 分钟内完成 |
| 2 | 53 个组件均可在编辑器中使用 |
| 3 | CRUD / Dashboard / Detail 三种页面类型均可自动生成 |
| 4 | 非技术人员可独立完成页面微调 |
| 5 | 设计 Token 在全链路中被严格遵守 |
| 6 | Page Schema 可导出为标准 JSON |
